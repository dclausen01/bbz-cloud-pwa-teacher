<!doctype html>
<html lang="en">
 <head> 
    <meta charset="UTF-8" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="msapplication-starturl" content="/">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="manifest" href="manifest.json">
    <title>BBZ Cloud</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="helper.js"></script>
    <link rel="icon" type="image/x-icon" href="icon.ico">
    <style>
     /* Additional styles if needed */
        body {
            overflow: hidden;
        }
    </style>
 </head>
 <body class="bg-gray-100 max-w-full">
    <div class="mx-auto p-2">
     <!-- Header with Logo and Buttons -->
     <div id="navbar" class="flex items-center justify-between h-16 bg-white p-2 shadow-md">
        <img
         src="https://www.bbz-rd-eck.de/wp-content/uploads/2018/09/BBZ-Logo-Master.png"
         alt="BBZ Logo"
         class="h-8 mr-4"
        />
        <h1 class="mb-4 mr-2 mt-2 xs:text-1xl text-center font-bold leading-none tracking-tight text-gray-900 md:text-4xl dark:text-blue">BBZ Cloud</h1>
        <div class="inline-flex">
            <button
	      id="schulCloudBtn"
	      class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold xs:text-xs sm:text-sm md:text-md lg:text-lg py-2 px-4 rounded-l"
            >
                schul cloud
            </button>
            <button
                id="moodleBtn"
                class="bg-orange-500 hover:bg-orange-700 text-white font-semibold xs:text-xs sm:text-sm md:text-md lg:text-lg py-2 px-4 rounded-none"
            >
                Moodle
            </button>
            <button id="bbbBtn"
                class="bg-blue-800 hover:bg-blue-900 text-white font-semibold xs:text-xs sm:text-sm md:text-md lg:text-lg py-2 px-4 rounded-none">
                Big Blue Button
            </button>
            <button id="owaBtn"
                class="bg-blue-600 hover:bg-blue-700 text-white font-semibold xs:text-xs sm:text-sm md:text-md lg:text-lg py-2 px-4 rounded-none">
                OWA
            </button>
            <button id="cryptPadBtn" class="bg-cyan-500 hover:bg-cyan-600 text-white xs:text-xs sm:text-sm md:text-md lg:text-lg font-semibold py-2 px-4 rounded-none">
                Crypt Pad
            </button>
            <button
                id="taskcardsBtn"
                class="bg-cyan-300 hover:bg-cyan-500 text-white xs:text-xs sm:text-sm md:text-md lg:text-lg font-semibold py-2 px-4 rounded-none"
            >
                Task Cards
            </button>
            <button id="bbzWikiBtn"
                class="bg-blue-300 hover:bg-blue-500 text-white xs:text-xs sm:text-sm md:text-md lg:text-lg font-semibold py-2 px-4 rounded-none">
                BBZ Wiki
            </button>
            <button id="dropdownBtn"
                class="bg-green-300 hover:bg-green-500 text-white font-semibold xs:text-xs sm:text-sm md:text-md lg:text-lg py-2 px-4 rounded-r">
                ...
            </button>
            <ul id="dropdownListe" class="absolute hidden bg-white text-gray-700 pt-1">
                <li class="flex justify-between">
                    <a href="https://office.com" target="_blank" class="block px-4 py-2 text-sm hover:bg-gray-100">
                        <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://www.office.com" class="inline-block h-4 mr-4">
                        <b>Office</b>
                    </a>
                </li>
                <li><a href="https://ladigitale.dev/digiscreen/" target="_blank" class="block px-4 py-2 text-sm hover:bg-gray-100">
                    <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://ladigitale.dev/digiscreen/" class="inline-block h-4 mr-4">
                    <b>Digiscreen</b>
                    </a>
                </li>
                <li><a href="https://bibox2.westermann.de/" target="_blank" class="block px-4 py-2 text-sm hover:bg-gray-100">
                    <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://bibox2.westermann.de/"
                        class="inline-block h-4 mr-4">
                        <b>BiBox</b>
                    </a>
                </li>
                <li><a href="https://my.plagaware.com/login" target="_blank" class="block px-4 py-2 text-sm hover:bg-gray-100">
                    <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://my.plagaware.com/"
                        class="inline-block h-4 mr-4">
                        <b>PlagScan</b>
                    </a>
                </li>
                <li><a href="https://kurzelinks.de/" target="_blank" class="block px-4 py-2 text-sm hover:bg-gray-100">
                    <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://kurzelinks.de/"
                        class="inline-block h-4 mr-4">
                        <b>Kurze Links</b>
                    </a>
                </li>
                <li><a href="https://portal.schule-sh.de/univention/portal/#/" target="_blank" class="block px-4 py-2 text-sm hover:bg-gray-100">
                    <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://portal.schule-sh.de/univention" 
                        class="inline-block h-4 mr-4">
                        <b>Schule.SH</b>
                    </a>
                </li>
                <li><hr></li>
                <li id="addEntryLI">
                    <button id="addEntryBtn" class="block px-4 py-2 text-center text-2xl hover:bg-blue-200">+</button>
                </li>
            </ul>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="hidden fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center">
        <div class="bg-white p-4 rounded">
            <h2 class="text-lg font-bold mb-2">Eintrag hinzufügen</h2>
            <input type="text" id="nameInput" placeholder="Name" class="border border-gray-300 p-2 mb-2" />
            <input type="text" id="urlInput" placeholder="URL" class="border border-gray-300 p-2 mb-2" />
            <button id="saveEntryBtn" class="bg-blue-500 text-white px-4 py-2 rounded">Speichern</button>
            <button id="cancelBtn" class="bg-gray-300 text-gray-700 px-4 py-2 rounded ml-2">Abbrechen</button>
        </div>
    </div>

   <!-- WebView Components -->
    <iframe id="webView" src="about:blank" class="w-full mt-1 border-0" preload="https://app.schul.cloud"></iframe>

</div>

<script>
    // Function to read entries from localStorage and append them to the list
    function appendEntriesFromLocalStorage() {
        const entries = JSON.parse(localStorage.getItem("entries"));
        const list = document.getElementById("dropdownListe");

        if (entries && Array.isArray(entries)) {
            entries.forEach((entry) => {
                const listItem = document.createElement("li");
                listItem.classList.add("flex", "justify-between");
                const link = document.createElement("a");
                // adding favicons
                const favicon = document.createElement("img");
                favicon.src = "https://s2.googleusercontent.com/s2/favicons?domain_url="+entry.url;
                favicon.classList.add("inline-block", "h-4", "mr-4");
                // adding link
                link.href = entry.url;
                link.target = "_blank";
                link.textContent = entry.name;
                link.classList.add("block", "px-4", "py-2", "text-sm", "hover:bg-gray-100");
                link.prepend(favicon);
                listItem.appendChild(link);

                const deleteButton = document.createElement("button");
                deleteButton.textContent = "-";
                deleteButton.classList.add("ml-2", "text-red-500", "hover:text-red-700", "font-bold", "text-2xl");
                deleteButton.addEventListener("click", () => {
                    const confirmDelete = confirm("Soll dieser Eintrag wirklich gelöscht werden?");
                    if (confirmDelete) {
                        listItem.remove();
                        // Code to delete the entry from localStorage
                        const entries = JSON.parse(localStorage.getItem("entries"));
                        const updatedEntries = entries.filter((entry) => entry.name !== link.textContent);
                        localStorage.setItem("entries", JSON.stringify(updatedEntries));
                        if (updatedEntries.length === 0) {
                            localStorage.removeItem("entries");
                        }
                        }
                    });
                listItem.appendChild(deleteButton);

                list.appendChild(listItem);
            });
        }
        // Move the addEntryLI element to the end of the list
        const addEntryItem = document.getElementById("addEntryLI");
        list.appendChild(addEntryItem);
    }

    // Call the function on page load
    window.addEventListener("load", appendEntriesFromLocalStorage);


    // Function to adjust the height of the WebView to the available space
    function adjustIframeHeight() {
        const navbarHeight = document.getElementById("navbar").offsetHeight;
        const iframe = document.getElementById("webView");
        iframe.style.height = `calc(100vh - ${navbarHeight+5}px)`;
    }
           
    // Call the function initially
    adjustIframeHeight();

    // Adjust iframe height when window is resized
    window.addEventListener("resize", adjustIframeHeight);

    // JavaScript to handle button actions and WebView interactions
    const webView = document.getElementById("webView");
    webView.src = "start.html";

    // Function to load a URL into the WebView and update the URL field
    function loadUrl(url) {
        webView.src = url;
    }
    
    function loadUrlNewWindow(url, type) {
        window.open(url, type, 'menubar=no, status=no, width=1100, height=700, location=no, toolbar=no');
    } 
    // Open modal when add entry button is clicked
    const addEntryBtn = document.getElementById("addEntryBtn");
    const modal = document.getElementById("modal");
    addEntryBtn.addEventListener("click", function() {
        modal.classList.remove("hidden");
    });

    // Save entry to localStorage when save button is clicked
    const saveEntryBtn = document.getElementById("saveEntryBtn");
    const nameInput = document.getElementById("nameInput");
    const urlInput = document.getElementById("urlInput");
    saveEntryBtn.addEventListener("click", function() {
        const name = nameInput.value;
        let url = urlInput.value;
        if (name && url) {
            if (!url.startsWith("http://") && !url.startsWith("https://")) {
                url = "https://" + url;
            }
            const entry = { name, url };
            const entries = JSON.parse(localStorage.getItem("entries")) || [];
            entries.push(entry);
            localStorage.setItem("entries", JSON.stringify(entries));
            nameInput.value = "";
            urlInput.value = "";
            modal.classList.add("hidden");
        }
        appendEntriesFromLocalStorage();
    });

    // Close modal when cancel button is clicked
    const cancelBtn = document.getElementById("cancelBtn");
    cancelBtn.addEventListener("click", function() {
        nameInput.value = "";
        urlInput.value = "";
        modal.classList.add("hidden");
    });

    // Button event listeners
    document
        .getElementById("schulCloudBtn")
        .addEventListener("click", () => loadUrl("https://app.schul.cloud"));
    document
        .getElementById("moodleBtn")
        .addEventListener("click", () =>
        loadUrl("https://portal.bbz-rd-eck.de"),
        );
    document
    .getElementById("owaBtn")
    .addEventListener("click", () =>
        loadUrlNewWindow("https://exchange.bbz-rd-eck.de/owa", "_blank"),
    );
    document
    .getElementById("bbbBtn")
    .addEventListener("click", () =>
        loadUrlNewWindow("https://bbb.bbz-rd-eck.de/b/signin", "_blank"),
    );
    document
    .getElementById("cryptPadBtn")
    .addEventListener("click", () => loadUrlNewWindow("https://cryptpad.fr", "_blank"));
    document
        .getElementById("taskcardsBtn")
        .addEventListener("click", () => loadUrl("https://bbzrdeck.taskcards.app/#/home/start"));
    document
    .getElementById("bbzWikiBtn")
    .addEventListener("click", () => loadUrl("https://wiki.bbz-rd-eck.com"));
    document
        .getElementById("dropdownBtn")
        .addEventListener("click", () => {
            const dropdownList = document.getElementById("dropdownListe");
            dropdownList.classList.toggle("hidden");
            const buttonRect = document.getElementById("dropdownBtn").getBoundingClientRect();
            dropdownList.style.top = `${buttonRect.bottom}px`;
            dropdownList.style.left = `${buttonRect.left-100}px`;
        });

    window.addEventListener("resize", () => {
        const dropdownList = document.getElementById("dropdownListe");
        const buttonRect = document.getElementById("dropdownBtn").getBoundingClientRect();
        dropdownList.style.top = `${buttonRect.bottom}px`;
        dropdownList.style.left = `${buttonRect.left-100}px`;
    });

    // Prevent scrolling 
    window.addEventListener("scroll", (e) => {
            e.preventDefault();
            window.scrollTo(0, 0);
        });

    // Close dropdown menu when a click event occurs anywhere on the screen
    window.addEventListener("click", (event) => {
        const dropdownList = document.getElementById("dropdownListe");
        if (!event.target.matches("#dropdownBtn") && !event.target.matches("#dropdownListe")) {
            dropdownList.classList.add("hidden");
        }
    });
            
    </script>
  </body>
</html>
